#!/bin/csh -f

#
# $Id$
#
# This script is used to build a platform-dependent makefile
# based on the environment variable SMART_PLATFORM
#

set ok = `env | grep "SMART_PLATFORM" | wc -c`
if ($ok) then
  echo Using platform: $SMART_PLATFORM
else
  echo Please set environment variable SMART_PLATFORM
  exit
endif

if ($# == 0) then
  echo Building module makefiles
  ./BuildMake Templates Base Rng Language States Formalisms Engines Chains Main
  echo Building overall makefile
  cd ../$SMART_PLATFORM
  echo "# Automatically generated by BuildMake script" >! Makefile
  echo OBJECTDIR = ../$SMART_PLATFORM >> Makefile
  echo SOURCEDIR = ../Source >> Makefile
  grep -v "#" make.platform >> Makefile
  grep -v "#" ../Source/make.common >> Makefile
  grep -v "#" ../Source/make.smart >> Makefile
  cd ../Source
endif

set j = 1
set stop = $#
while ($j <= $stop)
  echo Building makefile for $argv[$j] module
  mkdir ../$SMART_PLATFORM/$argv[$j]
  cd ../$SMART_PLATFORM/$argv[$j]
  echo "# Automatically generated by BuildMake script" >! Makefile
  echo OBJECTDIR = ../../$SMART_PLATFORM/$argv[$j] >> Makefile
  echo SOURCEDIR = ../../Source/$argv[$j] >> Makefile
  grep -v "#" ../make.platform >> Makefile
  grep -v "#" ../../Source/make.common >> Makefile
  grep -v "#" ../../Source/$argv[$j]/make.mod >> Makefile
  echo Generating dependencies
  make depend
  cat make.depend >> Makefile
  cd ../../Source
  @ j++
end

