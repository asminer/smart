/* 
   $Id$	
*/
	
/*
 *     Tests stangely shaped arrays
 */
	
/*
 *   Integer arrays
 */

/*  Normal array */
for (int i in {0..20}) {
  real fact[i] := cond(i<1, 1, i*fact[i-1]);
};

print("Testing factorial array, everything after index 20 is an error\n");
for (int i in {25..0..-1}) {
  print(i:3, "! = ", fact[i], "\n");
}

/* Check delayed evaluation */
for (int i in {30..0..-1}) {
  int fib[i] := cond(i<2, 1, fib[i-1]+fib[i-2]);
};

print("Testing fibonacci array, valid from 0..30\n");
for (int i in {32..-2..-1}) {
  print(i:3, "th fib:", fib[i], "\n");
}


/*  Checks strange indices  */

for (int i in {1..6, 10..2..-1}) {
  int f[i] := i;
  print("Assign f[",i,"] = ", f[i],"\n"); 
}

/* Multi dimensional Integer arrays */

for (int i in {1..5}, int j in {1..5}, int k in {i..j}) {
  int g1[i][j][k] := k;
  print("Assign g1[",i,"][",j,"][",k,"] = ",g1[i][j][k], "\n"); 
}

g1[1][3][2];
g1[1][2][3];
g1[5][5][5];


/*
 *    Tests bad array indices and compiler robustness
 */

for (int i in {0..9}, int j in {1..5}) {
  int g2[j][i] := i+j;

/*       ^^^^^   This should cause an error. */

}

g2[2][2];


/* 
     Real arrays 
 */

/* A simple real array */

for (real x in {0.1,0.2,0.3})
{
  real tr[x] := x;
  print("Assign tr[",x,"] = ", tr[x], "\n"); 
}

/*  Test of array index precision */

for (real x in {0.1}) {
  real g[x] := x;
  print("Assign g[",x,"] = ",g[x],"\n"); 
}

#IndexPrecision 1e-4
	
g[0.3];
g[0.2];
g[0.15];
g[0.13];
g[0.12];
g[0.11];
g[0.105];
g[0.102];
g[0.101];
g[0.1001];
g[0.10001];
g[0.100001];
g[0.1000001];
g[0.10000001];
g[0.100000001];
g[0.1000000001];
g[0.10000000001];
g[0.1];

/* Another bizarre array */

for (real x in {0.1,0.2}) {
  for (int k in {1..5}, int i in {3}) {
    real xki[x][k][i] := x*k*i ;
    print("Assign xki[",x,"][",k,"][",i,"] = ",xki[x][k][i],"\n"); 
  }
}

/* Yet another strange real array */

for (real x in {0.2..0.8..0.2}, real y in {0.2..0.8..0.2}, real z in {x..y..x*y}) {
  real xyz[x][y][z] := z;
  print("Assign xyz[",x,"][",y,"][",z,"] = ",xyz[x][y][z],"\n"); 
}

/*  These all are leagal */

xyz[0.2][0.2][0.2];
xyz[0.2][0.6][0.32];
xyz[0.4][0.8][0.72];

/* These are not */

xyz[0.6][0.2][0.2];
xyz[0.6][0.7][0.2];
xyz[0.6][0.6][0.8];


/* Testing wrong number of indices */
for (int i in {1..2}, int j in {10..20}, int k in {100..200}) {
  int wrongind[i][j][k] := i+j+k;
}
wrongind[1][10];
wrongind[1][10][100][3]; 

/* 
   Testing wrong index names and orders
*/

for (int i in {1..10}, int j in {1..10}) {
  int wrongorder[j][i] := i+j;
  int wrongname1[i][k] := i+j;
  int wrongname2[m][n] := i+j;
}
